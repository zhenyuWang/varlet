var w=Object.defineProperty;var y=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var z=(t,a,e)=>a in t?w(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,g=(t,a)=>{for(var e in a||(a={}))I.call(a,e)&&z(t,e,a[e]);if(y)for(var e of y(a))b.call(a,e)&&z(t,e,a[e]);return t};import{j as O,k as R}from"./elements.600984cd.js";import{E as C,d as G,w as h,F as N}from"./components.57927f97.js";const W="background-image",B="lazy-loading",P="lazy-error",p="lazy-attempt",T=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],l="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",c=[],i=[],_=N(100),n={loading:l,error:l,attempt:3,throttleWait:300,events:T};let f=h(s,n.throttleWait);function u(t,a){t._lazy.arg===W?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function D(t){t._lazy.loading&&u(t,t._lazy.loading),s()}function M(t){t._lazy.error&&u(t,t._lazy.error),t._lazy.state="error",d(t),s()}function E(t,a){u(t,a),t._lazy.state="success",d(t),s()}function S(t){var a;i.includes(t)||(i.push(t),(a=n.events)==null||a.forEach(e=>{t.addEventListener(e,f,{passive:!0})}))}function Y(){i.forEach(t=>{var a;(a=n.events)==null||a.forEach(e=>{t.removeEventListener(e,f)})}),i.length=0}function Z(t,a){var r,o;const e={loading:(r=t.getAttribute(B))!=null?r:n.loading,error:(o=t.getAttribute(P))!=null?o:n.error,attempt:t.getAttribute(p)?Number(t.getAttribute(p)):n.attempt};t._lazy=g({src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1},e),u(t,l),G(n.filter,t._lazy)}function V(t,a){const e=new Image;e.src=a,t._lazy.preloadImage=e,e.addEventListener("load",()=>{t._lazy.attemptLock=!1,_.add(a),E(t,a)}),e.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?M(t):L(t)})}function L(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(_.has(a)){E(t,a),t._lazy.attemptLock=!1;return}D(t),V(t,a)}async function m(t){await O(t)&&L(t)}function s(){c.forEach(t=>m(t))}async function j(t){!c.includes(t)&&c.push(t),R(t).forEach(S),await m(t)}function d(t){C(c,t),c.length===0&&Y()}function x(t,a){const{src:e,arg:r}=t._lazy;return e!==a.value||r!==a.arg}async function v(t,a){Z(t,a),await j(t)}async function F(t,a){if(!x(t,a)){c.includes(t)&&await m(t);return}await v(t,a)}function H(t={}){const{events:a,loading:e,error:r,attempt:o,throttleWait:A,filter:k}=t;n.events=a!=null?a:n.events,n.loading=e!=null?e:n.loading,n.error=r!=null?r:n.error,n.attempt=o!=null?o:n.attempt,n.throttleWait=A!=null?A:n.throttleWait,n.filter=k}const X={mounted:v,unmounted:d,updated:F,install(t,a){H(a),f=h(s,n.throttleWait),t.directive("lazy",this)}};export{X as L};
